---
title: "Aggregating Anteaters Project"
output: bookdown::html_document2
date: "2023-11-16"
---
<style>
    h1 {font-size: 1.8em;}
    h2 {font-size: 1.6em;}
    h3 {font-size: 1.4em;}
    .column {“display: inline-block;} 
    {max-width: 45%;} 
    {vertical-align: top;”}
</style>

```{r setup, include=FALSE}
# Formatting ----
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE, # (JMEP) makes sure html doc doesn't print warnings
                      message = FALSE) # (JMEP) makes sure html doc doesn't print messages


# Load required libraries ----
library(bookdown)
library(car)
library(tinytex)
library(tidyverse)
library(GGally)
library(ggExtra)
library(sjPlot)
library(kableExtra)
library(patchwork)
library(MKinfer)
library(RColorBrewer)

set.seed(010298)

# Download data ----
source("https://edin.ac/4616rYu")
get_my_data(group_name = "aggregating_anteaters")

# functions ----
print_p <- function(p) {
  print <- ifelse(p < 0.001, "< 0.001", str_c("= ", round(p,3)))
  return(print)
}

l2p <- function(logits) {
  odds <- exp(logits)
  prob <- odds/(1 + odds)
  return(prob)
}
```

# Data Preparation

```{r data cleaning}
# (JMEP) cleaning data ----
emoji_clean <- emoji |>
  filter(is.na(age) == F,
         age > 2,
         em_cat != "upside-down face",
         freq_emu >= 0) |>
  mutate(opsys = ifelse(opsys == "appple", "apple", opsys),
         opsys = factor(opsys, labels = sapply(unique(opsys), str_to_sentence)),
         em_cat_emoji = sapply(em_cat, emoji::emoji),
         em_cat = factor(em_cat,labels = sapply(unique(em_cat), str_to_sentence)),
         EI = factor(EI, labels = sapply(unique(EI), str_to_sentence)))

# (JMEP) exlcuded data table ----
excl_tab <- emoji |> 
  mutate(
    exclusion_reason = ifelse(is.na(name) == T, 
                              "Name is missing",
                        ifelse(is.na(age) == T, 
                               "Age is missing",
                        ifelse(age < 7,
                               "Impossible or unlikely age",
                        ifelse(is.na(opsys) == T,
                               "Operating system is missing",
                        ifelse(is.na(freq_emu) == T,
                               "Frequency of Emoji use is missing",
                        ifelse(freq_emu < 0,
                               "Impossible frequency value (negative) is reported",
                        ifelse(is.na(em_cat) == T,
                               "Emoji category is missing",
                        ifelse(em_cat != "loudly crying face" &
                                 em_cat != "slightly smiling face" &
                                 em_cat != "thumbs up",
                               "Emoji not in study materials is reported",
                        ifelse(is.na(EVS) == T,
                               "Emotional valence score is missing",
                        ifelse(is.na(EI) == T,
                               "Emoji Interpretation is missing",
                               "not excluded"))))))))))) |>
  filter(exclusion_reason != "not excluded")
```

Before describing the data, we conducted some initial checks to ensure that all observations were entered within their possible ranges (for continuous variables) or levels (for categorical variables). We used some initial visualisations of the marginal distributions and relationships amongst the variables to find these impossible values (see Figure \@ref(fig:ini-pairs-panels) for the pre-processed data in the Appendix). We excluded impossible values along with any observations containing missing data (N~excluded~ = `r nrow(excl_tab)`). Table \@ref(tab:exclude) in the Appendix provides an overview of these excluded data points and the reason for exclusion. Additionally, the spelling of 'Apple' was corrected in the operating system entry of `r nrow(filter(emoji, opsys=="appple"))` observations from 'Appple'.

# Data Description

## Association Between Operating System and Frequency of Emoji Use

We explored whether there's a difference in the frequency of emoji use between Apple and Android users. We did this in two ways - we created violin plots, and conducted a bootstrapped t-test. 

From Figure \@ref(fig:q1b-violin-plot), we can see that the lower quartile and median of the two operating systems are very similar. However,  the upper quartile is higher and the overall range is larger for Apple than Android. It seems that Apple users are more likely to use a higher number of emojis per day. Android users, however, are more densely concentrated around the median. There are only three  unusually high values at 24 emojis per day, all reported by Apple users.

```{r q1b-violin-plot, fig.cap="Frequency of Emoji Use on Apple and Android Operating System", fig.align='center', fig.height = 3.3}
emoji_clean |>
  filter(opsys !="Windows") |>
ggplot(aes(x = opsys, y = freq_emu, fill = opsys)) + 
  geom_jitter(alpha = .3, height = 0)+
  geom_violin(alpha = 0.5) +
  geom_boxplot(width=0.1) + 
  scale_fill_brewer(palette = "Accent")+
  labs(x = "Operating system", y = "Frequency of emoji use (emoji/day)", fill="Operating System")+
  theme_light()
```

```{r}
# t-test ----
q1t_test <-t.test(freq_emu ~ opsys, data = filter(emoji_clean, opsys != "Windows"))

# shapiro Wilks + equal variance test ----
emoji_qq2 <- emoji_clean|>
  filter(opsys=="Android")
shappy_wilks_and <- shapiro.test(emoji_qq2$freq_emu) # greater than 0.05
emoji_qq1 <- emoji_clean|>
  filter(opsys=="Apple")
shappy_wilks_app <- shapiro.test(emoji_qq1$freq_emu) # greater than 0.05
var_test <- var.test(freq_emu ~ opsys, filter(emoji_clean, opsys != "Windows"))

# bootstrap standard error
boot_t_test <- boot.t.test(freq_emu ~ opsys, data = filter(emoji_clean, opsys != "Windows"))
```

Initially, we conducted a Welch two sample t-test to assess whether the mean frequency of emoji use was different between Android (*Android n* = `r nrow(filter(emoji_clean, opsys == "Android"))` ; *m* = `r round(q1t_test$estimate [1],1)`; *sd* = `r round(sd(filter(emoji_clean, opsys == "Android")$freq_emu), 2)`) and Apple users (*n* = `r nrow(filter(emoji_clean, opsys == "Apple"))`; *m* = `r round(q1t_test$estimate[2],2)`; *sd* = `r round(sd(filter(emoji_clean, opsys == "Apple")$freq_emu), 2)`). There was a significant difference in emoji use between Android and Apple users (*t*(`r round(q1t_test$parameter,2)`) = `r round(q1t_test$statistic,2 )`, *p* `r print_p(q1t_test$p.value)`, two-tailed). However, an assumption of the Welch test is normal distribution, but when we ran two Shapiro-Wilks tests (*Android p* = `r print_p(shappy_wilks_and$p.value)`; *Apple p* = `r print_p(shappy_wilks_app$p.value)`) and plotted Q-Q plots we found that neither operating system showed normal distribution (graphs in appendix). To account for the lack of normality, we decided to use a bootstrapped Welch t-test, which confirmed that the difference was significant, even with the non-normal distribution (*Confidence intervals 97.5%* = `r round(boot_t_test$boot.conf.int[2],2)`; *Confidence interval 2.5%* = `r round(boot_t_test$boot.conf.int[1], 2)` ; *Estimate - Android* = `r round(boot_t_test$estimate[1], 2)`; *Estimate - Apple* = `r round(boot_t_test$estimate[2], 2)`). As such, we can reject the null hypothesis that there is no difference in emoji use between Apple and Android users.

 
## Correlation Between Age and Frequency of Emoji Use

```{r}
shappy_wilks <- shapiro.test(emoji_clean$freq_emu) # greater than 0.05
shappy_wilks2 <- shapiro.test(emoji_clean$age) # greater than 0.05
```

To assess if there is a relationship between participant age and the frequency of their emoji use we were going to conduct a Pearson correlation test. However, upon visualising these variables and their relationship in Figure \@ref(fig:cor-plot), these do not conform to the assumptions of a Pearson correlation coefficient. Firstly, age and frequency seem to co-move in a negative but non-linear fashion with a decreasing size of the slope across frequency of emoji use. The accompanying histograms reveal that the frequency of emoji and age are not normally distributed, as verified by Shapiro–Wilk tests (Frequency of emoji use: *W* = `r round(shappy_wilks$statistic, 2)`, *p* `r print_p(shappy_wilks$p.value)`; Age: *W* = `r round(shappy_wilks2$statistic, 2)`, *p* `r print_p(shappy_wilks2$p.value)`) with the former seeming to follow a Poisson distribution while latter is largely uniform. Since both a normal distribution and a linear relationship are assumptions of a Pearson correlation test, we conducted a Spearman's rank correlation test, which tests for a monotonic relationship between two variables without assumptions about the normality of their distributions or a linear relationship. 

To assess if there was a relationship between participant age and the frequency of their emoji use, we conducted a Pearson correlation test. However, upon visualising these variables and their relationship in Figure \@ref(fig:cor-plot), we found that they do not conform to the assumptions of a Pearson correlation coefficient. Firstly, age and frequency seem to co-move in a negative but non-linear fashion with a decreasing size of the slope across frequency of emoji use. The accompanying histograms reveal that the frequency of emoji and age are not normally distributed (verified by Shapiro–Wilk tests: *W (frequency of emoji use)* = `r round(shappy_wilks$statistic, 2)`, *p* `r print_p(shappy_wilks$p.value)`; *W (age)* = `r round(shappy_wilks2$statistic, 2)`, *p* `r print_p(shappy_wilks2$p.value)`) with the former seeming to follow a Poisson distribution while latter is largely uniform. Since both a normal distribution and a linear relationship are assumptions of a Pearson correlation test, we conducted a Spearman's rank correlation test, which tests for a monotonic relationship between two variables without assumptions about the normality of their distributions or a linear relationship. 

```{r cor-plot, fig.cap="Relationship Between Age and Frequency of Emoji Use", fig.align='center', fig.height = 4}
p_cor <- ggplot(emoji_clean, aes(x=age, y=freq_emu)) + 
  geom_point(alpha = 0.5) + 
  labs(x = "Age",
       y = "Frequency of emoji use (emoji/day)")+
  theme_light()
ggMarginal(p_cor, type = "hist", xparams = list(binwidth = 1, fill = "#CBD6E8"), yparams = list(binwidth = 1, fill = "#F4CAE3"))
```

```{r correlation test}
q1b_cortest_np <- cor.test(emoji_clean$age, emoji_clean$freq_emu, method= "spearman")
```

The Spearman's rank correlation test was conducted to assess whether there is a relationship between the age of an individual, and their frequency of emoji use. A total of `r nrow(emoji_clean)` individuals were included in the analysis, with a mean age of `r round(mean(emoji_clean$age),2 )` (*sd* = `r round(sd(emoji_clean$age),2 )`) and a mean frequency of use of emoji of `r round(mean(emoji_clean$freq_emu),2 )` (*sd* = `r round(sd(emoji_clean$freq_emu),2 )`). There was a strong negative correlation between age of an individual and the frequency of emoji use (*R* = `r round(q1b_cortest_np$estimate,2)`, *S* = `r q1b_cortest_np$statistic`), *p* `r print_p(q1b_cortest_np$p.value)`). We therefore reject the null hypothesis that there is no correlation between age and frequency of emoji use.  

## Balance of Users of Operating Systems for Emoji Categories

```{r q1c-bar-plot, fig.cap="Distribution of Participants on Apple and Android Operating System for Each Emoji Category", fig.height = 2.5, fig.align='center'}
ggplot(data = filter(emoji_clean, opsys != "Windows"), aes(x = em_cat, fill = opsys))+
  geom_bar(position = "dodge", color = "black") +
  labs(fill = "Operating System Used", x = "Emoji Category", y = "Number of Participants")+
  scale_fill_brewer(palette = "Pastel2")+
  theme_light()
```

Finally, we investigated whether there is a balance between Apple and Android users for each category of emoji. Figure \@ref(fig:q1c-bar-plot) shows the distribution of operating systems for each emoji category. For all categories we can see that the number of Apple users is slightly larger than Android users, with the largest difference for the thumbs up emoji (`r emoji::emoji("thumbs up")`). We conducted a $\chi^2$ goodness of fit test for each emoji category to test if these differences were significant. This tested if the observed proportion of participants using each operating system deviated from a hypothesised equal proportion of users (50% each), which would indicate balance.

```{r chi square test}
# chi square tests ----
# chi square for loudly crying face
q1_chisq_cry <- emoji_clean |>
  filter((opsys == "Apple" | opsys == "Android") & em_cat == "Loudly crying face") |>
  droplevels() |>
  select(opsys) |>
  table() |>
  chisq.test()

# chi square for slightly smiling face
q1_chisq_smile <-emoji_clean |>
  filter((opsys == "Apple" | opsys == "Android") & em_cat == "Slightly smiling face") |>
  droplevels() |>
  select(opsys) |>
  table() |>
  chisq.test()

# chi square for thumbs up
q1_chisq_thumb <-emoji_clean |>
  filter((opsys == "Apple" | opsys == "Android") & em_cat == "Thumbs up") |>
  droplevels() |>
  select(opsys) |>
  table() |>
  chisq.test()

# proportion table ----
prop <- emoji_clean |>
  filter(opsys != "Windows") |>
  droplevels() |>
  group_by(em_cat,opsys)|>
  summarise(n = n()) |>
  mutate(total_n =sum(n[em_cat == em_cat]),
    prop = round(n/total_n*100,2)) 
```

For each emoji category, we found no significant difference between the observed proportions of Apple and Android users, and a hypothesised set of equal proportions. For loudly crying face emoji (`r emoji::emoji("loudly crying face")`), $\chi^2$ (`r q1_chisq_cry$parameter`) = `r round(q1_chisq_cry$statistic, 2)`, *p* `r print_p(q1_chisq_cry$p.value)` (*n* = `r nrow(filter(emoji_clean, opsys != "Windows" & em_cat == "Loudly crying face"))`, *proportion~Apple~* = `r filter(prop, opsys == "Apple" & em_cat == "Loudly crying face")$prop` %). For the slightly smiling face  emoji (`r emoji::emoji("slightly smiling face")`),  $\chi^2$ (`r q1_chisq_smile$parameter`) = `r round(q1_chisq_smile$statistic, 2)`, *p* `r print_p(q1_chisq_smile$p.value)` (*n* = `r nrow(filter(emoji_clean, opsys != "Windows" & em_cat == "Slightly smiling face"))`, *proportion~Apple~* = `r filter(prop, opsys == "Apple" & em_cat == "Slightly smiling face")$prop` %). Finally, for the thumbs up emoji (`r emoji::emoji("thumbs up")`), $\chi^2$ (`r q1_chisq_thumb$parameter`) = `r round(q1_chisq_thumb$statistic, 2)`, *p* `r print_p(q1_chisq_thumb$p.value)` (*n* = `r nrow(filter(emoji_clean, opsys != "Windows" & em_cat == "Thumbs up"))`, *proportion~Apple~* = `r filter(prop, opsys == "Apple" & em_cat == "Thumbs up")$prop` %). Thus, we found no evidence of imbalance of users of Apple and Android operated phones in each emoji category.

# The Emotional Effect of Emojis

One of the main aims we address in this research is the investigation of factors influencing emotional valence. We fitted a multiple regression model to predict whether the frequency of use of the emoji, the type of emoji, as well as the age of the participants, and the interaction between age and emoji category has an effect on their emotional valence. We mean-centered age and scaled the emotional valence score for interpretation of coefficients and intercepts. Emoji category was treatment coded with the "loudly crying face" emoji (`r emoji::emoji("loudly crying face")`) as the reference level (please see \@ref(tab:cat-code-tab)).

As noted previously, neither age (approximately uniform; Figure \@ref(fig:q2-desc-plots)D) nor frequency of emoji use (approximately Poisson distributed; Figure \@ref(fig:q2-desc-plots)E) were normally distributed. There were slightly more participants in the loudly crying face emoji (`r emoji::emoji("loudly crying face")`) than the other emoji categories (Figure \@ref(fig:q2-desc-plots)). Figure \@ref(fig:q2-desc-plots) B also indicates a negative relationship between age and emotional valence score; as age increases, the emotional valence score decreases. In particular, the loudly crying face emoji (`r emoji::emoji("loudly crying face")`) shows a steep negative correlation with age. These relationships will be more closely evaluated in our linear regression model.

One of the main aims we address in this research is the investigation of factors influencing emotional valence. We fitted a multiple regression model to predict whether the frequency of use of the emoji, the type of emoji, as well as the age of the participants, and the interaction between age and emoji category has an effect on their emotional valence. We mean-centered age and scaled the emotional valence score for interpretation of coefficients and intercepts. Emoji category was treatment coded with the "loudly crying face (`r emoji::emoji("loudly crying face")`)" as the reference level (please see \@ref(tab:cat-code-tab)).


```{r}
# Original model ----
m2intq2 <- (lm(scale(EVS) ~ freq_emu + I(age-mean(age)) * em_cat , data = emoji_clean))
ano_q2 <- anova(m2intq2)

# Assumptions ----
shapiro_wilks_int <- shapiro.test(residuals(m2intq2)) #normality
ncvTest_int <- ncvTest(m2intq2)#(testing) constant variance #above the text - otherwise can't see them. 

# Sensitivity analyses ----
m2intq2_sensitivity <- (lm(scale(EVS) ~ freq_emu + I(age-mean(age)) * em_cat , data = emoji_clean[-c(2,13,175), ]))
ano_q2_sense <- anova(m2intq2_sensitivity)

shapiro_wilks_sensitivity <- shapiro.test(residuals(m2intq2_sensitivity))
ncvTest_sensitivity <- ncvTest(m2intq2_sensitivity)
```

```{r q2-desc-plots, fig.cap="Relationships (A-B) and Marginal Distributions (C-F) of Variables of Interest for Emotional Effect", fig.width=11}
# shut down----
p_age_evs <- ggplot(emoji_clean, aes(x = EVS, y = age, color = em_cat,
                                     fill = em_cat))+
  geom_smooth(method = "lm")+
  geom_jitter(alpha = .3, height = 0)+
  scale_color_brewer(palette = "Accent")+
  scale_fill_brewer(palette = "Accent")+
  facet_wrap(~em_cat)+
  labs(x = "Emotional valence score", y = "Age",
       title = "(B) Emotional Valence Score by Age for each Emoji Category")+ 
  theme_light()+
  theme(legend.position = "none",
        strip.background = element_rect(fill ="white", color = "grey"),
        strip.text = element_text(color = "black"),
        plot.title = element_text(size = 11))

p_freq_evs <- ggplot(emoji_clean, aes(x = EVS, y = freq_emu))+
  geom_smooth(method = "lm", color = "#386CB0", fill = "#386CB0")+
  geom_jitter(alpha = .3, height = 0, color = "#386CB0")+
  labs(x = "Emotional valence score", y = "Frequency of emoji use",
       title = "(A) Emotional Valence Score by Frequency of Emoji Use")+ 
  theme_light()+
  theme(legend.position = "none",
        strip.background = element_rect(fill ="white", color = "grey"),
        strip.text = element_text(color = "black"),
        plot.title = element_text(size = 11))

p_evs <- ggplot(emoji_clean, aes(x = EVS))+
  geom_density(color = "black", fill = "#8DD3C7") +
  labs(x = "Emotional valence score", y = "Density", title = "(C) Emotional Valence Score" )+
  theme_light()+
  theme(plot.title = element_text(size = 11))

p_em_cat <- ggplot(emoji_clean, aes(x = em_cat))+
  geom_bar(color = "black", fill = "#FB8072")+
  labs(x = "Emoji category", y = "Number of participants", title = "(F) Emoji Category")+
  theme_light()+
  theme(plot.title = element_text(size = 11),
        axis.text.x = element_text(angle = 14))

p_age <- ggplot(emoji_clean, aes(x = age))+
  geom_density(color = "black", fill = "#CBD6E8") +
  labs(x = "Age", y = "Density", title = "(D) Age" )+
  theme_light()+
  theme(plot.title = element_text(size = 11))

p_freq <- ggplot(emoji_clean, aes(x = freq_emu))+
  geom_density(color = "black", fill = "#F4CAE3") +
  labs(x = "Frequency (emoji/day)", y = "Density", title = "(E) Frequency of Emoji Use") +
  theme_light()+
  theme(plot.title = element_text(size = 11))

(p_freq_evs| p_age_evs) / (p_evs|p_age|p_freq|p_em_cat) + plot_layout(heights = c(2.5,1))
```

Prior to conducting our analyses, we assessed whether the assumptions for conducting a linear model were met. Given the previously found strong correlation between age and frequency of emoji use, we checked for multicollinarity between the variables. Multicollinarity did not seem to be a problem, as all GVIF were <5 (Table \@ref(tab:q2-vif)). While a significant Shapiro-Wilks (*W* = `r round(shapiro_wilks_int$statistic,2)`, *p* `r print_p(shapiro_wilks_int$p.value)`) indicated non-normality, model residuals looked normally distributed (Figure \@ref(fig:ass-for-q2)B), with the exception of three outliers. Moreover, Breusch-Pagan was also significant (*$\chi^2$* (`r (ncvTest_int$Df)`) = `r round(ncvTest_int$ChiSquare,2)`, *p* `r print_p(ncvTest_int$p)`), indicating non-constant variance, despite Figure \@ref(fig:ass-for-q2)A and C showing a seemingly straight line. We furthermore conducted a Cook's Distance analysis and identified three outliers (Figure \@ref(fig:ass-for-q2)D). The threshold for this determination was given by $4/(N-k-1)$, in which *N* is the number of observations and *k* is the number of predictors. Given this threshold of 0.017, it was determined that we should exclude three observations and fit a new model without them. Excluding the three outliers changed Shapiro-Wilk (*p* `r print_p(shapiro_wilks_sensitivity$p.value)`) and Breusch-Pagan (*p* `r round (ncvTest_sensitivity$p,2)`) to non-significant, ensuring that the data meets the assumptions of a linear model. 

```{r}
ano_row <- c( 
  "Emoji usage", 
  "Age",
  "Emoji category",
  "Age:Emoji category",
  "Residuals")

rownames(ano_q2_sense) <- ano_row
  
ano_q2_sense |>
  rename("p.value" = "Pr(>F)") |>
  rename("f.value" = "F value") |>
  mutate(Df = ifelse(is.na(Df) == T, "", Df),
         f.value = ifelse(is.na(f.value) == T, "", round(f.value,2)),
         p.value = ifelse(is.na(p.value) == T, "", ifelse(p.value < 0.001, "< 0.001", round(p.value,3)))) |>
  kable(digits = 2, 
        # proper column names
        col.names = c("Df", 
                      "Sum of Squares", 
                      "Mean Sum of Squares", 
                      "F value", 
                      "P value"),
        caption = "Emotional Effect of Emojis: Analysis of Variance Table (Sensitivity Analysis)",
        booktabs = T) |> 
  kable_styling(htmltable_class = "lightable-classic", position = "float_right", full_width = T)
```

```{r tab-model}
tab_model(m2intq2, m2intq2_sensitivity,show.stat=T, 
          dv.labels = c("Emotional Valence (Full Dataset Model)", "Emotional Valence (Reduced Dataset Model"), 
          pred.labels = c("Intercept", 
                          "Emoji use frequency", 
                          "Age", 
                          str_c("Emoji [", emoji::emoji("slightly smiling face"),"]"), 
                          str_c("Emoji [", emoji::emoji("thumbs up"),"]"), 
                          str_c("Age:Emoji [", emoji::emoji("slightly smiling face"),"]"), 
                          str_c("Age:Emoji [", emoji::emoji("thumbs up"),"]")), 
          string.stat = "t-statistic ", 
          string.p = "p-value ", 
          string.ci = "95 % CI",
          show.r2 = T,
          show.se = T,
          title = "(\\#tab:tab-model) Emotional Effect of Emojis Model")
```

An analysis of variance was conducted on the model which excluded the three outlying values. This analysis indicated that frequency of emoji use was a significant predictor of the emotional valence score (*F*(1,227) = 172.89, *p*<0.001), and the interaction between age and emoji category was also found to be a significant predictor (*F*(2,227) = 12.26, *p*<0.001). Age alone was not a significant predictor (*F*(1,227) = 1.22, *p* = 0.27), nor was emoji category alone (*F*(2,227) = 1.81, *p* = 0.17). This model explained 46% (adjusted *R^2^*) of the variance within the data.

Prior to removing the three values that were shown to have undue influence on the model fit, we fit a model including all values present in the dataset. The two models are compared in Figure \@ref(tab:tab-model). When the three influential values were removed, the interaction between all three categories of emoji and age reached significance (*p~slightly_smiling~* <0.001, *p~thumbs_up~* <0.001, *p~loudly_crying~* <0.001). Therefore, this model indicates that the estimated score for someone of age 35 who has been presented with the loudly crying face emoji (`r emoji::emoji("loudly crying face")`), the estimated emotional valence is 0.6 standard deviations below the mean (*CI*[-0.91, -0.38], *t* = -5.46, *p* <0.001). For every year increase in the participant's age, their emotional valence score will decrease by an estimated 0.03 standard deviations  (*CI*[-0.04, -0.01], *t* = -3.73, *p* <0.001), while every one unit increase in emoji use frequency will result in an estimated 0.12 SD increase (*CI*[.08, 0.15], *t* = 7.49, *p* <0.001). As we have established that there is a significant interaction in age and emoji category, we can also state that for every year increase, the emotional valence score will increase by an estimated 0.04 standard deviations more in the slightly smiling face group (`r emoji::emoji("slightly smiling face")`)  (*CI*[0.02, 0.06], *t* = 4.39, *p* <0.001) compared to the loudly crying face group (`r emoji::emoji("loudly crying face")`), and 0.03 standard deviations more in the thumbs up group (`r emoji::emoji("thumbs up")`) (*CI*[0.02, 0.05], *t* = 3.91, *p* <0.001) compared to the loudly crying face group (`r emoji::emoji("loudly crying face")`). These interactions are plotted in Figure \@ref(fig:q2-interaction-plot). 


```{r q2-interaction-plot, fig.cap="The interaction of Age and Emoji Category on the EVS", fig.height=2.5, fig.width=9, fig.align='center'}
# plot interactions 
p2 <- interactions::interact_plot(m2intq2_sensitivity, pred = "age", modx = "em_cat", interval = TRUE, x.label = "Age", y.label = "Emotional Valence Score", legend.main = "Emoji Category")
p2
```

## Conclusion
Our research in this area aimed to determine how emotional valence is affected by the frequency of emoji use, the age of participants, and the category of emoji. The results of our model after reducing the data indicated that the strongest predictor of emotional valence was the frequency of emoji use, followed by the interaction between emoji category and age. Age alone was not a significant predictor of the emotional valence score. 

# Accuracy of Emoji Interpretation

```{r logistic regression and anova}
# data prep ----
emoji_q3_analysis <- emoji_clean |>
  mutate(EI_bi = ifelse(EI == "Incorrect", 0, 1),
         age_mc = I(age-mean(age)))

# model fit and analysis of deviance----
# model fit
m1q3 <- glm(EI_bi ~ freq_emu + age_mc*em_cat, data = emoji_q3_analysis, family = binomial)

m1q3_tests <-summary(m1q3)

# analysis of deviance
ano_q3 <- anova(m1q3, test = "Chisq") |>
  rename("p.value" = "Pr(>Chi)")

# Model coefficient plot ----

# Age for each emoji category while keeping frequency constant
q3_plotdata_age_em <- tibble(
  freq_emu = rep(0, 45*3),
  age_mc = rep(seq(min(emoji_q3_analysis$age_mc), max(emoji_q3_analysis$age_mc), 1),3),
  em_cat = c(rep(unique(emoji_clean$em_cat) [1], 45), 
             rep(unique(emoji_clean$em_cat) [2], 45),
             rep(unique(emoji_clean$em_cat) [3], 45))
)

# Age and emoji category plot
q3_p2 <- broom::augment(m1q3, newdata = q3_plotdata_age_em, 
               type.predict = "link",
               se_fit=TRUE) |>
  mutate(
    .lower = l2p(.fitted - 1.96*.se.fit),
    .upper = l2p(.fitted + 1.96*.se.fit),
    .fitted = l2p(.fitted),
    age = I(age_mc + mean(emoji_clean$age))
  ) |> 
  ggplot(aes(x=age,y=.fitted, group = em_cat, ymin=.lower,
             ymax=.upper))+
  geom_line(aes(color = em_cat))+
  geom_ribbon(alpha=.2, aes(fill = em_cat))+
  scale_colour_brewer(palette = "Dark2")+
  scale_fill_brewer(palette = "Dark2")+
  labs(x = "Age", y = "P(Correct Emoji Interpretation)", 
       color =  "Emoji Category", fill ="Emoji Category")+
  theme_light() +
  theme(legend.key = element_rect("white"),
        legend.background = element_rect(fill= "white", color ="black"),
        legend.position = c(0.7,0.8))
```

Finally, we address what factors make participants more or less likely to correctly interpret emojis (according to the researchers' coding scheme). The predictors of interest were the same as before; frequency of emoji use first to control for its known effect on interpreting emoji, and age and emoji category along with the interaction between these to investigate if there is an effect of age on interpretation accuracy and if this depends on the emoji. Figure \@ref(fig:q3-desc-plots) provides an overview of the marginal distribution of emoji interpretation accuracy (Figure \@ref(fig:q3-desc-plots)C; see Figure \@ref(fig:q2-desc-plots) for marginal distributions of predictors) and its relationships with age by emoji category (Figure \@ref(fig:q3-desc-plots)A) and for frequency of emoji use (Figure \@ref(fig:q3-desc-plots)B). Generally, a slightly higher proportion of participants interpreted their emoji incorrectly - the thumbs up emoji (`r emoji::emoji("thumbs up")`) seemed particularly hard to get correct while the louddly crying face emoji (`r emoji::emoji("loudly crying face")`) seemed to have a slightly higher proportion of correct responses (Figure \@ref(fig:q3-desc-plots)C). Examining the median age and frequency in Figures \@ref(fig:q3-desc-plots)A-B, it seems that incorrect responses are more common for older participants and for those who use emoji less frequently. Figure \@ref(fig:q3-desc-plots)A provided some indication that the emoji being interpreted may moderate the relationship between lower age and correct interpretations - specifically, that the thumbs up emoji (`r emoji::emoji("thumbs up")`) seem to have slightly lower median age for correct interpretations.

```{r q3-desc-plots, fig.cap="Relationships with Variables of Interest (A-B) and Marginal Distribution (C) for Interpretation Accuracy", fig.width=10, fig.height=5}
p_age_acc <- ggplot(emoji_clean, aes(x = EI, y = age, fill = em_cat))+
  geom_jitter(alpha = .3, height = 0)+
  geom_violin(alpha = 0.5) +
  geom_boxplot(width = 0.2) + 
  facet_wrap(~em_cat)+
  scale_fill_brewer(palette = "Accent")+
  labs(x = "Interpretation accuracy", y = "Age",
       title = "(A) Emoji Interpretation Accuracy for Age and Emoji Category")+ 
  theme_light()+
  theme(legend.position = "none",
        strip.background = element_rect(fill ="white", color = "grey"),
        strip.text = element_text(color = "black"),
        plot.title = element_text(size = 11))

p_freq_acc <- ggplot(emoji_clean, aes(x = EI, y = freq_emu, fill = EI))+
  geom_jitter(alpha = .3, height = 0)+
  geom_violin(alpha = 0.5) +
  geom_boxplot(width = 0.2) + 
  scale_fill_brewer(palette = "Set3")+
  labs(x = "Interpretation accuracy", y = "Frequency (emoji/day)", 
       title = "(B) Emoji Interpretation Accuracy Frequency of Emoji Use")+
  theme_light()+
  theme(legend.position = "none",
        plot.title = element_text(size = 11))

p_EI <- ggplot(emoji_clean, aes(x = EI, fill = em_cat))+
  geom_bar(color = "black")+
  scale_fill_manual(values = c("#C6DBEF" ,"#6BAED6", "#2171B5"))+
  ylim(c(0,230))+
  labs(x = "Interpretation accuracy", y = "Number of participants", 
       title = "(C) Emoji Interpretation Accuracy", fill = "Emoji category")+
  theme_light()+
  theme(legend.title = element_text(size = 10),
        legend.text = element_text(size=9),
        legend.key = element_rect("white"),
        legend.background = element_rect(fill= "white", color ="black"),
        plot.title = element_text(size = 11))

(p_age_acc | (p_freq_acc/p_EI) ) + plot_layout(widths = c(1.5,1))
```

## Model Fitting and Planned Analysis

Given the binary outcome (correct vs. incorrect interpretation; see Figure \@ref(fig:q3-desc-plots)C), we fitted a multiple logistic regression model via maximum likelihood estimation. This estimates the change in log odds ratio of correct interpretation for changes in each predictor (see eq. \@ref(eq:q3-model)). We included the predictors as outlined above. Like the previous model, we mean-centered age so that the log odds of the intercept were estimated for the mean age of the sample rather than extrapolated to age 0. We treatment coded emoji category with the loudly crying face emoji (`r emoji::emoji("loudly crying face")`) as the reference level  (coding scheme in the Appendix, Table \@ref(tab:cat-code-tab)). This provides two dummy coded variables ($D_1$ and $D2$ in eq. \@ref(eq:q3-model)) representing the mean difference in log odds of successful interpretation between this reference level and each of the slightly smiling face emoji (`r emoji::emoji("slightly smiling face")`) and the thumbs up emoji (`r emoji::emoji("thumbs up")`). Thus, we fitted a model where the intercept was the log odds ratio of correctly interpreting a loudly crying face emoji (`r emoji::emoji("loudly crying face")`) for a mean-aged participant reporting using 0 emoji/day. Equation \@ref(eq:q3-model) shows the exact model fitted:

\begin{align}
\log[ \frac {P(Correct)}{P(Incorrect)}] = & \ \hat\beta_0 + \hat\beta_{1}(Frequency) + \hat\beta_{2}(Age) + \hat\beta_{3}D_{1[slightly \ smiling \ face]} + \hat\beta_{4}D_{2[thumbs \ up]} \ + \\ 
& \ \hat\beta_{5}(Age · D_{1[slightly \ smiling \ face]}) + \hat\beta_{6}(Age · D_{2[thumbs \ up]}) (\#eq:q3-model)
\end{align} 

We conducted the following tests (all at $\alpha$ = .05 unless otherwise stated) to address which factors are associated with more or less likelihood of correctly interpreting the tested Emoji. Firstly, we tested if each of the predictors and the interaction significantly improved model fit with an analysis of deviance for the full model using likelihood ratio ($\chi^2$) tests to test if each significantly reduced model deviance. Secondly, we examined regression coefficients of age and its interaction, their direction, range with 95 % confidence intervals, and significance with *z*-tests ($H_0: \hat\beta_i \neq 0$). Before examining the model, we verified that the model fit did not violate assumptions of logistic regression by inspecting the range of the standardised deviance residuals (plotted in Figure \@ref(fig:q3-ass-diag)A; a priori criterion range: $|standardised \ deviance \ residual| ≤ 3$). Given the sizable correlation between frequency of Emoji use and age (see Data Description), we also confirmed that multicollinearity, i.e., model estimates being influenced by correlated predictors, was negligible by estimating generalised variance inflation factors for each predictor (all below the a priori criterion of 5; see Table \@ref(tab:q3-vif)). Finally,the Cook's distances, i.e., the average change in predictors if removing each observation, indicated three potentially influential observations (see Appendix, Figure \@ref(fig:q3-ass-diag)B). After inspecting these observations (see Appendix, Table \@ref(tab:influ-obs-tab-q3)) and how they influenced model predictors (via DFBeta values; see Appendix, Table \@ref(tab:influ-tab-q3)), we performed two sensitivity analyses; (1) excluding one observation which seemed to influence the slope of age and frequency, and (2) excluding two observations influencing emoji category slopes and their interactions. Comparing these results to the model fitted to the full dataset we find no differences in significances or directions for the planned analyses (analysis of deviance: Table\@ref(tab:sens-ans-dev-q3); regression coefficients: \@ref(tab:sens-an-coef-tab-q3) and Figure \@ref(fig:sens-an-plot)). Therefore, we report the model for the full dataset below. For (1) we find no changes in the regression slopes, while for (2) we find minor shifts in the regression slopes for the thumbs up emoji, which we report briefly in the results section.

## Results

As shown in Table \@ref(tab:q3-dev-tab), likelihood ratio tests indicated that age significantly improved model fit above and beyond what frequency of emoji use alone could account for ($\chi^2$(`r ano_q3$Df[3]`) = `r round(ano_q3$Deviance[3],2)`, *p* `r print_p(ano_q3$p.value[3])`). The interaction between age and emoji category further significantly reduced deviance of the model ($\chi^2$(`r ano_q3$Df[5]`) = `r round(ano_q3$Deviance[5],2)`, *p* `r print_p(ano_q3$p.value[5])`) although inclusion of emoji category alone did not affect model deviance ($\chi^2$(`r ano_q3$Df[4]`) = `r round(ano_q3$Deviance[4],2)`, *p* `r print_p(ano_q3$p.value[4])`). Thus, age and its interaction with emoji category, each significantly contributed to improving predicted interpretation accuracy beyond what could be accounted for by frequency of emoji use.

```{r q3-dev-tab}
# proper row names
rownames(ano_q3)<- c(
  "Intercept-only", 
  "Emoji use frequency", 
  "Age",
  "Emoji category",
  "Age:Emoji category"
  )

# print table
ano_q3 |>
  mutate(Df = ifelse(is.na(Df) == T, "", Df),
         Deviance = ifelse(is.na(Deviance) == T, "", round(Deviance,2)),
         p.value = ifelse(is.na(p.value) == T, "", ifelse(p.value < 0.001, "< 0.001", round(p.value,3)))
         ) |>
  kable(digits = 2, 
        # proper column names
        col.names = c("Df", 
                      "Deviance", 
                      "Residual Df", 
                      "Residual Deviance", 
                      "p-value"),
        caption = "Emoji Interpretation: Analysis of Deviance Table",
        booktabs = T) |> 
  kable_styling(htmltable_class = "lightable-classic")
```

Looking at how these variables predicted accurate interpretation, we found that per year older, the odds of making an incorrect interpretation became `r round(1/exp(m1q3$coef[3]),2)` times bigger ($\frac {1}{OR}$; *OR* = `r round(exp(m1q3$coef[3]),2)`, 95 % *CI*[`r round(exp(confint(m1q3)[3,1]),2)`, `r round(exp(confint(m1q3)[3,2]),2)`]; *z* = `r round(coef(summary(m1q3))[,"z value"][3],2)`, *p* `r print_p(coef(summary(m1q3))[,"Pr(>|z|)"][3])`). However, this association with age was specific to the loudly crying face emoji (`r emoji::emoji("loudly crying face")`) and was moderated by which emoji was interpreted as suggested by the analysis of deviance. Specifically, the thumbs up emoji (`r emoji::emoji("thumbs up")`) enhanced the negative effect of age on interpretation accuracy; for this emoji, the odds of making an incorrect interpretation for each year older was `r round(1/exp(m1q3$coef[7]),2)*round(1/exp(m1q3$coef[3]),2)` times bigger than for the loudly crying emoji (`r emoji::emoji("loudly crying face")`) ($\frac {1}{OR}$; *OR* = `r round(exp(m1q3$coef[7]),2)`, 95 % *CI*[`r round(exp(confint(m1q3)[7,1]),2)`, `r round(exp(confint(m1q3)[7,2]),2)`]; *z* = `r round(coef(summary(m1q3))[,"z value"][7],2)`, *p* `r print_p(coef(summary(m1q3))[,"Pr(>|z|)"][7])`). We also found that the odds of correctly interpreting the thumbs up emoji (`r emoji::emoji("thumbs up")`) holding age constant were significantly lower than for the loudly crying face emoji  (`r emoji::emoji("loudly crying face")`) (*OR* = `r round(exp(m1q3$coef[5]),2)`, 95 % *CI*[`r round(exp(confint(m1q3)[5,1]),2)`, `r round(exp(confint(m1q3)[5,2]),2)`]; *z* = `r round(coef(summary(m1q3))[,"z value"][5],2)`, *p* `r print_p(coef(summary(m1q3))[,"Pr(>|z|)"][5])`). Meanwhile, the slightly smiling face emoji (`r emoji::emoji("slightly smiling face")`) did not differ significantly from the loudly crying face emoji (`r emoji::emoji("loudly crying face")`) for its odds of correct interpretation (*OR* = `r round(exp(m1q3$coef[4]),2)`, 95 % *CI*[`r round(exp(confint(m1q3)[4,1]),2)`, `r round(exp(confint(m1q3)[4,2]),2)`]; *z* = `r round(coef(summary(m1q3))[,"z value"][4],2)`, *p* `r print_p(coef(summary(m1q3))[,"Pr(>|z|)"][4])`) or how this changed with age (*OR* = `r round(exp(m1q3$coef[6]),2)`, 95 % *CI*[`r round(exp(confint(m1q3)[6,1]),2)`, `r round(exp(confint(m1q3)[6,2]),2)`]; *z* = `r round(coef(summary(m1q3))[,"z value"][6],2)`, *p* `r print_p(coef(summary(m1q3))[,"Pr(>|z|)"][6])`). We found no significant effect of Emoji use frequency^[Note, that this discrepancy of significance for the frequency of emoji use between the analysis of deviance and logistic regression coefficient may be related to how much it uniquely reduces model deviance and its correlation with age. Specifically, it may share a large amount of the reduced deviance with age due to their correlation - thus, in the analysis of deviance due to its antecedency this overlap was attributed to it, yet, in the linear model only non-overlapping deviance is considered. This also suggests that age has a sizable unique impact on deviance compared to frequency.] or any other coefficients. A full overview of the regression results as odds ratios are reported in Table \@ref(tab:q3-tab-model).

<div style='display: inline-block; max-width: 55%; vertical-align: top;float: inline-start; margin-inline-end: 30px'>
```{r q3-tab-model}
tab_model(m1q3, 
          transform = "exp",
          show.stat=T, 
          dv.labels = "Correct Emoji Interpretation", 
          pred.labels = c("Intercept", 
                          "Emoji use frequency", 
                          "Age", 
                          str_c("Emoji [", emoji::emoji("slightly smiling face"),"]"), 
                          str_c("Emoji [", emoji::emoji("thumbs up"),"]"), 
                          str_c("Age:Emoji [", emoji::emoji("slightly smiling face"),"]"), 
                          str_c("Age:Emoji [", emoji::emoji("thumbs up"),"]")), 
          string.stat = "z-statistic ", 
          string.p = "p-value ", 
          string.ci = "95 % CI", 
          string.est = "Odds Ratio ",
          show.r2 = F,
          show.dev = T,
          show.loglik = T,
          show.se = T,
          title = "(\\#tab:q3-tab-model) Interpretation Accuracy Model")
```
</div>

<div style='display: inline-block; max-width: 43%; vertical-align: top'>
```{r q3-model-plots, fig.cap="Predicted Probability of Correct Emoji Interpretation Age for Each Emoji Tested", fig.height=7.3}
q3_p2
```
</div>



Figure \@ref(fig:q3-model-plots) visualises the predicted probability of correctly interpreting emoji for the age by emoji category interaction; the probability of accurately interpreting the emoji for the sample age range, split by each emoji category, and holding frequency of emoji use constant (at 0). Emphasising the results of the regression coefficients, the probability of correctly interpreting the thumbs up emoji (`r emoji::emoji("thumbs up")`) seem to change more with age than the other emoji categories. Although as shown by the overlapping uncertainty ranges, the predicted effects may also be very similar for most ages.

## Sensitivity Analyses

We conducted two sensitivity analyses of these results due to potential influence. While the first sensitivity analysis demonstrated no change in the regression coefficients () or analysis of deviance (), we found two influential observations, which from their DFBetas indicated a strong influence on the emoji category coefficients and their interactions with age. Upon excluding these, the estimate of for the thumbs up emoji and its interaction became lower but more certain (), thus, the effect on interpretation accuracy of the thumbs up emoji and how it interacts with age may be slightly smaller than what the main analyis suggests. We chose to retain these for the main analysis since they did not affect the significance of any predictors and their low Cook's distances are relatively low.

## Conclusion

We found that older age decreased how likely participants were to interpret emoji correctly. Although the extent of this was moderated by the emoji being interpreted. The thumbs up emoji (`r emoji::emoji("thumbs up")`) had a generally lower likelihood of being interpreted correctly and this decreased more in older participants than the other emojis in the study. In short, age seem to have a negative impact on how emojis are interpreted although the extent of this depends on the emoji.

# Appendix: Supplementary Tables and Figures

## Data Preparation

```{r ini-pairs-panels, fig.cap="Marginal Distributions and Between-Variable Relationships for Pre-Processed Data", fig.width=11,fig.height=13}
emoji |> 
  select("age", "EVS", "freq_emu", "em_cat", "EI", "opsys") |>
  mutate(em_cat = factor(em_cat, labels = c("Cry", "Smile", "Thumbs", "Upside-down"))) |>
  ggpairs(columnLabels = c("Age", "Emotional Valence Score", "Frequency of Emoji Use", 
                           "Emoji Category", "Emoji Interpretation", "Operating System")
    ) 
```

```{r exclude} 
excl_tab |>
  mutate(opsys = factor(opsys, labels = c("Android", "Apple"))) |>
  kable(col.names = c("Name", "Age", "Operating system", "Emoji use frequency",
                      "Emoji category", "Emotional valence score",
                      "Emoji Interpretation", "Reason for exlcusion"),
        caption = "Excluded Observations",
        booktabs = T, digits = 2) |> 
  kable_styling(htmltable_class = "lightable-classic")
```

## Data Description

```{r qq-plot-freq, fig.cap="QQPlot"}
emoji_qq1 <- emoji_clean|>
  filter(opsys=="Apple")
emoji_qq2 <- emoji_clean|>
  filter(opsys=="Android")

par(mfrow = c(1, 2)) #combining plots in one line 

qqnorm(
       main = "A) Normal Q-Q Plot: Apple",
       emoji_qq1$freq_emu)
qqline(emoji_qq1$freq_emu)

qqnorm(
  main = "B) Normal Q-Q Plot: Android",
  emoji_qq2$freq_emu)
qqline(emoji_qq2$freq_emu)
```

## The Emotional Effect of Emojis

```{r cat-code-tab}
kable(contrasts(emoji_clean$em_cat), col.names = c("D1", "D2"), 
      caption = "Emoji Category Treatment Contrast Coding Scheme",
      booktabs = T) |>
  kable_styling(htmltable_class = "lightable-classic", full_width = T)
```

```{r ass-for-q2, fig.cap="Assumptions for Linear Regression Model"}
par(mfrow = c(2, 2))

plot(m2intq2, which = 1, main = "A")
plot(m2intq2, which = 2, main = "B")
plot(m2intq2, which = 3, main = "C")
plot(m2intq2, which = 4, main = "D")
```

```{r q2-vif}
vif_q2 <- vif(m2intq2)[,1:2]

rownames(vif_q2) <-c("Emoji use frequency","Age","Emoji category","Age:Emoji category")

kable(vif_q2, digits = 2, caption = "Variance Inflation Factors for Predictors of Emotional Effect") |>
  kable_styling(htmltable_class = "lightable-classic")
```

```{r q2-influence}
inf_mat_q2<- influence.measures(m2intq2)$infmat
inf_mat_q2[c(2, 13, 175),] |> 
  kable(digits = 2,
        col.names = c("DFBeta intercept", "DFBeta frequency", "DFBeta age", str_c("DFBeta Emoji [", emoji::emoji("slightly smiling face"),"]"), str_c("DFBeta Emoji [", emoji::emoji("thumbs up"),"]"), str_c("DFBeta age:Emoji [", emoji::emoji("slightly smiling face"),"]"), str_c("DFBeta age:Emoji [", emoji::emoji("thumbs up"),"]"), "DFFit", "Covariance ratio", "Cook's Distance", "Hat values"),
        caption = "Influence Measures for Potentially Influential Values",
        booktabs = T) |>
  kable_styling(htmltable_class = "lightable-classic")
```

## Accuracy of Emoji Interpretation

```{r q3-ass-diag, fig.cap= "(A) Standardised Deviance Residuals and (B) Cook's Distances for the Interpretation Accuracy Model"}
par(mfrow = c(1, 2))
plot(rstandard(m1q3, type = 'deviance'), ylab = 'Standardised Deviance Residuals',
     main = "(A) Standardised Deviance Residuals")
plot(m1q3, which=4, main = "(B) Cook's Distances" )
```

```{r q3-vif}
vif_q3 <- vif(m1q3)[,1:2]

rownames(vif_q3) <-c("Emoji use frequency","Age","Emoji category","Age:Emoji category")

kable(vif_q3, digits = 2,
      caption = "Variance Inflation Factors for Predictors of Interpretation Accuracy", booktabs = T) |>
  kable_styling(htmltable_class = "lightable-classic")
```

```{r influ-tab-q3}
infl_q3 <-influence.measures(m1q3)$infmat 

infl_q3[c(13, 75, 218),] |> 
  kable(digits = 2,
        col.names = c("DFBeta intercept", "DFBeta frequency", "DFBeta age", str_c("DFBeta Emoji [", emoji::emoji("slightly smiling face"),"]"), str_c("DFBeta Emoji [", emoji::emoji("thumbs up"),"]"), str_c("DFBeta age:Emoji [", emoji::emoji("slightly smiling face"),"]"), str_c("DFBeta age:Emoji [", emoji::emoji("thumbs up"),"]"), "DFFit", "Covariance ratio", "Cook's Distance", "Hat values"),
        caption = "Influence Measures for Potentially Influential Values",
        booktabs = T) |>
  kable_styling(htmltable_class = "lightable-classic")
```

```{r influ-obs-tab-q3}
emoji_q3_analysis[c(13, 75, 218),-c(8:10)] |> kable(digits = 2,
        col.names = c("Name", "Age", "Operating system", "Emoji use frequency",
                      "Emoji category", "Emotional valence score",
                      "Emoji Interpretation", "Reason for exlcusion"),
        caption = "Potentially Influential Observations",
        booktabs = T) |>
  kable_styling(htmltable_class = "lightable-classic")
```

```{r sensitivity analysis}
m2q3 <- glm(EI_bi ~ freq_emu + age_mc*em_cat, data = emoji_q3_analysis[-c(75,218),], family = binomial)
m3q3 <- glm(EI_bi ~ freq_emu + age_mc*em_cat, data = emoji_q3_analysis[-c(13),], family = binomial)
```

```{r sens-ans-dev-q3}
ano2_q3 <- anova(m2q3, test = "Chisq")
ano3_q3 <- anova(m3q3, test = "Chisq")

ano_row <- c(
  "Intercept-only", 
  "Frequency", 
  "Age",
  "Emoji",
  "Age:Emoji")
rownames(ano2_q3) <- ano_row
rownames(ano3_q3) <- ano_row

ano2_q3 |>
    rename("p.value" = "Pr(>Chi)") |>
  mutate(Df = ifelse(is.na(Df) == T, "", Df),
         Deviance = ifelse(is.na(Deviance) == T, "", round(Deviance,2)),
         p.value = ifelse(is.na(p.value) == T, "", ifelse(p.value < 0.001, "< 0.001", round(p.value,3)))) |>
  kable(digits = 2, 
        # proper column names
        col.names = c("Df", 
                      "Deviance", 
                      "Res. Df", 
                      "Res. Deviance", 
                      "p-value"),
        caption = "Emoji Interpretation: Analysis of Deviance Table (Sensitivity Analysis 1)",
        booktabs = T) |> 
  kable_styling(htmltable_class = "lightable-classic", position = "float_left", full_width = F)

ano3_q3 |>
  rename("p.value" = "Pr(>Chi)") |>
  mutate(Df = ifelse(is.na(Df) == T, "", Df),
         Deviance = ifelse(is.na(Deviance) == T, "", round(Deviance,2)),
         p.value = ifelse(is.na(p.value) == T, "", ifelse(p.value < 0.001, "< 0.001", round(p.value,3)))) |>
  kable(digits = 2, 
        # proper column names
        col.names = c("Df", 
                      "Deviance", 
                      "Res. Df", 
                      "Res. Deviance", 
                      "p-value"),
        caption = "Emoji Interpretation: Analysis of Deviance Table (Sensitivity Analysis 2)",
        booktabs = T) |> 
  kable_styling(htmltable_class = "lightable-classic", position = "float_right", full_width = F)
```

```{r sens-an-coef-tab-q3}
tab_model(m1q3, m2q3, m3q3,show.stat=T, 
          dv.labels = c("Reported model", "Sensitivity Analysis 1", "Sensitivity Analysis 2"), 
          pred.labels = c("Intercept", 
                          "Emoji use frequency", 
                          "Age", 
                          str_c("Emoji [", emoji::emoji("slightly smiling face"),"]"), 
                          str_c("Emoji [", emoji::emoji("thumbs up"),"]"), 
                          str_c("Age:Emoji [", emoji::emoji("slightly smiling face"),"]"), 
                          str_c("Age:Emoji [", emoji::emoji("thumbs up"),"]")), 
          string.stat = "z-statistic ", 
          string.p = "p-value ", 
          string.ci = "95 % CI", 
          string.est = "Odds Ratio ",
          show.r2 = F,
          show.dev = T,
          show.loglik = T,
          show.se = T,
          title = "(\\#tab:sens-an-coef-tab-q3) Table of Coefficients for the Reported Model and Sensitivity Analyses for Emoji Interpretation Accuracy")
```

```{r sens-an-plot, fig.width=9, fig.cap="Predicted Probability of Correct Emoji Interpretation Age for Each Emoji Tested for (A) Sensitivity Analysis 1 and (B) Sensitivity Analysis 2", fig.width= 8, fig.height=3, fig.align='center'}
# Age and emoji category plot
(broom::augment(m2q3, newdata = q3_plotdata_age_em, 
               type.predict = "link",
               se_fit=TRUE) |>
  mutate(
    .lower = l2p(.fitted - 1.96*.se.fit),
    .upper = l2p(.fitted + 1.96*.se.fit),
    .fitted = l2p(.fitted),
    age = I(age_mc + mean(emoji_clean$age))
  ) |> 
  ggplot(aes(x=age,y=.fitted, group = em_cat, ymin=.lower,
             ymax=.upper))+
  geom_line(aes(color = em_cat))+
  geom_ribbon(alpha=.2, aes(fill = em_cat))+
  scale_colour_brewer(palette = "Dark2")+
  scale_fill_brewer(palette = "Dark2")+
  labs(x = "Age", y = "Probability of Correct Emoji Interpretation", 
       color =  "Emoji Category", fill ="Emoji Category", title = "(A) Sensitivity Analysis 1")+
  theme_light())|
# Age and emoji category plot
(broom::augment(m3q3, newdata = q3_plotdata_age_em, 
               type.predict = "link",
               se_fit=TRUE) |>
  mutate(
    .lower = l2p(.fitted - 1.96*.se.fit),
    .upper = l2p(.fitted + 1.96*.se.fit),
    .fitted = l2p(.fitted),
    age = I(age_mc + mean(emoji_clean$age))
  ) |> 
  ggplot(aes(x=age,y=.fitted, group = em_cat, ymin=.lower,
             ymax=.upper))+
  geom_line(aes(color = em_cat))+
  geom_ribbon(alpha=.2, aes(fill = em_cat))+
  scale_colour_brewer(palette = "Dark2")+
  scale_fill_brewer(palette = "Dark2")+
  labs(x = "Age", y = "P(Correct Emoji Interpretation)", 
       color =  "Emoji Category", fill ="Emoji Category", title = "(B) Sensitivity Analysis 2")+
  theme_light())
```
